<html>
  <h2>Web to case Proof of Content -- Connected to UAT environment</h2>
  <!-- ---------------------------------------------------------------------- -->
  <!-- NOTE: Please add the following <META> element to your page <HEAD>.     -->
  <!-- If necessary, please modify the charset parameter to specify the       -->
  <!-- character set of your HTML page.                                       -->
  <!-- ---------------------------------------------------------------------- -->
  <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
  <script src="https://www.google.com/recaptcha/api.js"></script>
  <!-- ---------------------------------------------------------------------- -->
  <!-- NOTE: Please add the following <FORM> element to your page.            -->
  <!-- ---------------------------------------------------------------------- -->
  <!-- ---------------------------------------------------------------------- -->
  <!-- NOTE: These fields are optional debugging elements. Please uncomment   -->
  <!-- these lines if you wish to test in debug mode.                         -->
  <!-- <input type="hidden" name="debug" value=1>                             -->
  <!-- <input type="hidden" name="debugEmail"                                 -->
  <!-- value="eduardo.asenjo+web2case-ni@pexlify.com">                    -->
  <!-- ---------------------------------------------------------------------- -->
  <div style="background: #f1f1f1; padding: 20px; color: #333">
    <form action="https://niac--uat.my.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8" method="POST">
      <div style="background: #DAE1E9; padding: 10px;">
        <p>
          We want to make this process as easy as possible for you. If your pay premiums to us from an Ulster Bank or KBC account, please update your new bank account details below.
        </p>
        <p><b>Important information</b></p>
        <ul style="list-style-type: initial">
          <li>
            Your new bank account details will be processed as soon as possible. However, if your next premium billing date is within the next 5 days, we may automatically attempt to collect premiums from your current KBC or Ulster Bank account. Rest assured, this will be updated with your new bank account details for the following premium collection date.
          </li>
          <li>
            We recently sent you a letter with a unique pin number. You will need this pin number to update your bank details below. If you’ve more than one policy, you’ll receive a separate letter for each policy with a unique pin number for each one and will need to update each policy separately.
          </li>
          <li>
            Before updating your new bank details below, please ensure:
            <ul style="list-style: circle">
              <li>Your new bank account is active</li>
              <li>Your bank account comes from a EU bank</li>
              <li>Your New Ireland policy is active</li>
              <li>The payee(s) and policy owner(s) on the policy are the same</li>
            </ul>
          </li>
        </ul>
      </div>
      <div style="font-size: 1rem;">
        <p style="font-weight: 600;">Please provide the following details:</p>
        <p>
          <label><span style="color: red;" title="Required field">*</span>Policy Number</label> <br /> <input style="
          padding: 6px 10px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;" pattern="^([A-Z\d])*$" id="00N3O00000BFMdw" minlength="8" maxlength="8" name="00N3O00000BFMdw" required="true" size="8" type="text" />
        </p>
        <p>
          <label><span style="color: red;" title="Required field">*</span>Unique Pin Number</label> <span title="You'll find this in the letter we sent you">&#128712;</span> <br /> <input style="
          padding: 6px 10px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;" pattern="^([A-Za-z \d])*$" id="00N3O00000BFMdx" minlength="5" maxlength="5" name="00N3O00000BFMdx" required="true" size="8" type="text"/>
        </p>
        <p>
          <label><span style="color: red;" title="Required field">*</span>Bank Account Holder(s) Name</label> <span title="For joint accounts, please add both bank account holders' names.">&#128712;</span> <br /> <input style="
          padding: 6px 10px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;" pattern="^([A-Za-z \d])*$" id="00N3O00000BFMdu" maxlength="30" name="00N3O00000BFMdu" required="true" size="32" type="text" />
        </p>
        <p>
          <label><span style="color: red;" title="Required field">*</span>New IBAN</label> <span title="An IBAN is an International Bank Account Number. You'll find this on your bank statements or online bank account app.">&#128712;</span> <br /> <input style="
          padding: 6px 10px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;" id="00N3O00000BFMe0" maxlength="32" name="00N3O00000BFMe0" pattern="^(?:(?:IT|SM)\d{2}[A-Z]\d{22}|CY\d{2}[A-Z]\d{23}|NL\d{2}[A-Z]{4}\d{10}|LV\d{2}[A-Z]{4}\d{13}|(?:BG|BH|GB|IE)\d{2}[A-Z]{4}\d{14}|GI\d{2}[A-Z]{4}\d{15}|(?:RO|VG)\d{2}[A-Z]{4}\d{16}|KW\d{2}[A-Z]{4}\d{22}|MT\d{2}[A-Z]{4}\d{23}|NO\d{13}|(?:DK|FI|GL|FO)\d{16}|(?:MK|SI)\d{17}|(?:AT|EE|KZ|LU|XK|LT)\d{18}|(?:BA|HR|CH|CR)\d{19}|(?:GE|DE|LT|ME|RS)\d{20}|IL\d{21}|(?:AD|CZ|ES|SA|SK|SE)\d{22}|PT\d{23}|(?:BE|IS)\d{24}|(?:FR|MR|MC)\d{25}|(?:AL|DO|LB|PL|HU)\d{26}|(?:AZ|HU)\d{27}|(?:GR|MU)\d{28})|(BE\d{14})|(CY[0-9]{10}[A-z0-9]{16})|(LI\d{7}[A-Z0-9]{12})$" required="true" size="32" type="text"/>
        </p>
        <p>
          <input style="width:1rem; height:1rem;" id="00N3O00000BFMdv" name="00N3O00000BFMdv" required="true" type="checkbox" value="1" /> <label><span style="color: red;" title="Required field">*</span>Please tick here to confirm that the new bank account belongs to the person who is paying for this policy or owns the policy.</label>
        </p>
        <p>
          <label><span style="color: red;" title="Required field">*</span>Is the new bank account a joint account?</label> <br /><select style="padding: 6px 10px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          background-color: #FFF;
          box-sizing: border-box;" id="00N3O00000BFMdy" title="Is the new account a jointly held account?" name="00N3O00000BFMdy" required="true"> <option value="">--Select--</option> <option value="Yes">Yes</option> <option value="No">No</option> </select>
        </p>
        <p>
          <input style="width:1rem; height:1rem;" id="00N3O00000BFMdt" name="00N3O00000BFMdt" type="checkbox" value="1" /> <label>If this is a joint account, please tick here to confirm both bank account holders agree to this bank account update.</label>
        </p>
      </div>
      <div style="background: #DAE1E9; padding: 10px; margin: 10px 0px;">
        <div>
          <p>
          Please note that as you are not signing a paper mandate, by continuing with this form, you authorise (A) New Ireland to send instructions to your bank to debit your account and (B) your Bank to debit your account in accordance with the instruction from New Ireland.
        </p>
        <p>
          As part of your rights, you are entitled to a refund from your bank under the terms and conditions of your agreement with your bank. A refund must be claimed within 8 weeks starting from the date on which your account was debited. Your rights are explained in a statement that you can obtain from your bank”. New Ireland, 5-9 South Frederick Street, Dublin 2.
        </p>
        </div>
        <p style="font-size:1rem;">
          <input style="width:1rem; height:1rem;" id="00N3O00000BFMds" name="00N3O00000BFMds" required="true" type="checkbox" value="1" /> <label><span style="color: red;" title="Required field">*</span>Agree</label>
        </p>
      </div>
      <div style class="g-recaptcha" data-sitekey="6LdL6jUiAAAAAKOTO4sa7cmrHBDBbNH0wa89_mKU"></div>
      <input style="font-size: 1rem; background-color: #1C5E87; color: white; padding: 14px 20px; margin: 8px 0; border: none; border-radius: 4px; cursor: pointer;" name="submit" type="submit" value="Update details" />
      <p border="1" border-color="red">
        <input id="external" name="external" type="hidden" value="1" /> <input type="hidden" name="captcha_settings" value='{"keyname":"BankAccountTest","fallback":"true","orgId":"00D3O0000008m78","ts":""}'/> <input type="hidden" name="orgid" value="00D3O0000008m78" /> <input name="retURL" type="hidden" value="https://test.raspisdojo.com/thankyou"/> <input id="type" name="type" type="hidden" value="DDM_Form" />
      </p>
    </form>
  </div>

  <script>
    let SubmitButton = document.getElementsByName("submit")[0];
    let IBANInputField = document.getElementById("00N3O00000BFMe0");
    let AccountJointlyHeldInputField =
      document.getElementById("00N3O00000BFMdy");
    let AgreeCheckbox = document.getElementById("00N3O00000BFMds");
    let AccountExistingPayeeCheckbox =
      document.getElementById("00N3O00000BFMdv");
    let JointAccountCheckbox = document.getElementById("00N3O00000BFMdt");

    function onSubmitButtonClick(event) {
      let isValid = isPolicyNumberValid();
      isValid = isValid ? isValid && isAgreeValid() : false;
      isValid = isValid ? isValid && isIBANValid() : false;
      isValid = isValid ? isValid && isAccountExistingPayeeValid() : false;
      isValid = isValid ? isValid && isAccountJointlyHeldValid() : false;
      isValid = isValid ? isValid && isJointAccountValid() : false;

      // COMMENT CAPTCHA LINE BELOW TO TEST WITHOUT CAPTCHA
      isValid = isValid ? isValid && isCaptchaValid() : false;

      if (isValid === false) {
        event.preventDefault();
      }
    }

    function isPolicyNumberValid() {
      let policy_number = document.getElementById("00N3O00000BFMdw");
      return isValidPredicate(
        policy_number,
        "Your Policy Number and Unique Identifier do not match an account on record",
        () => {
          let actual_value = getDigits(policy_number.value);
          let policy_hex_value = (Number(actual_value) % 256)
            .toString(16)
            .toUpperCase();
          if (policy_hex_value.length === 1)
            policy_hex_value = "0" + policy_hex_value;
          let unique_identifier = document.getElementById("00N3O00000BFMdx");
          return policy_hex_value === unique_identifier.value.slice(0, 2);
        }
      );
    }

    function isCaptchaValid() {
      return isValidPredicate(SubmitButton, "Captcha Not Filled", () => {
        let response = document.getElementById("g-recaptcha-response");
        return response != null && response.value.trim() != "";
      });
    }

    function isIBANValid() {
      return isValidPredicate(
        IBANInputField,
        "Please confirm your New IBAN number",
        () => {
          return IBANInputField.checkValidity();
        }
      );
    }

    function isAccountExistingPayeeValid() {
      return isValid(
        AccountExistingPayeeCheckbox,
        "Please confirm the new account is held by the existing payee"
      );
    }

    function isAccountJointlyHeldValid() {
      return isValid(
        AccountJointlyHeldInputField,
        "Please confirm if account is jointly held"
      );
    }

    function isJointAccountValid() {
      return isValidPredicate(
        JointAccountCheckbox,
        "Please confirm all parties have agreed to the direct debit change",
        () => {
          let value =
            AccountJointlyHeldInputField.options[
              AccountJointlyHeldInputField.selectedIndex
            ].value;
          return value === "Yes" ? JointAccountCheckbox.checked : true;
        }
      );
    }

    function isAgreeValid() {
      return isValid(AgreeCheckbox, "The box must be checked to continue");
    }

    function onIbanInput(event) {
      IBANInputField.setCustomValidity("");
      IBANInputField.value = event.target.value.toUpperCase();
      IBANInputField.setSelectionRange(
        IBANInputField.selectionStart,
        IBANInputField.selectionStart
      );
    }

    function onAccountJointlyHeldInput() {
      AccountJointlyHeldInputField.setCustomValidity("");
      let value =
        AccountJointlyHeldInputField.options[
          AccountJointlyHeldInputField.selectedIndex
        ].value;
      if (value === "Yes") {
        JointAccountCheckbox.setAttribute("required", "");
      } else {
        JointAccountCheckbox.removeAttribute("required", "");
        JointAccountCheckbox.setCustomValidity("");
      }
    }

    function isValid(input_field, error_message) {
      let input_type = input_field.type;
      let valid;
      if (input_type === "checkbox") {
        valid = input_field.checked;
      } else {
        valid = !!input_field.value;
      }
      setValidity(input_field, error_message, valid);
      return valid;
    }

    function isValidPredicate(input_field, error_message, predicate) {
      let valid = predicate();
      setValidity(input_field, error_message, valid);
      return valid;
    }

    function setValidity(input_field, error_message, valid) {
      if (valid === false) {
        input_field.setCustomValidity(error_message);
        input_field.reportValidity();
      } else {
        input_field.setCustomValidity("");
      }
    }

    function getDigits(value) {
      let returnVal = "";
      for (i = 0; i < value.length; i++) {
        let c = value.charAt(i);
        if (c >= "0" && c <= "9") {
          returnVal = returnVal + c;
        }
      }
      return returnVal;
    }

    SubmitButton.addEventListener("click", (event) =>
      onSubmitButtonClick(event)
    );
    IBANInputField.addEventListener("input", (event) => onIbanInput(event));
    AccountJointlyHeldInputField.addEventListener("input", () =>
      onAccountJointlyHeldInput()
    );
    AgreeCheckbox.addEventListener("input", () => {
      AgreeCheckbox.setCustomValidity("");
    });
    AccountExistingPayeeCheckbox.addEventListener("input", () => {
      AccountExistingPayeeCheckbox.setCustomValidity("");
    });
    JointAccountCheckbox.addEventListener("input", () => {
      JointAccountCheckbox.setCustomValidity("");
    });

    function timestamp() {
      var response = document.getElementById("g-recaptcha-response");
      if (response == null || response.value.trim() == "") {
        var elems = JSON.parse(
          document.getElementsByName("captcha_settings")[0].value
        );
        elems["ts"] = JSON.stringify(new Date().getTime());
        document.getElementsByName("captcha_settings")[0].value =
          JSON.stringify(elems);
      }
    }
    setInterval(timestamp, 500);
  </script>
</html>
