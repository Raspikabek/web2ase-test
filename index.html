<html>
  <h2>Web to case Proof of Content -- Connected to UAT environment</h2>
  <!-- ---------------------------------------------------------------------- -->
  <!-- NOTE: Please add the following <META> element to your page <HEAD>.     -->
  <!-- If necessary, please modify the charset parameter to specify the       -->
  <!-- character set of your HTML page.                                       -->
  <!-- ---------------------------------------------------------------------- -->
  <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
  <script src="https://www.google.com/recaptcha/api.js"></script>
  <!-- ---------------------------------------------------------------------- -->
  <!-- NOTE: Please add the following <FORM> element to your page.            -->
  <!-- ---------------------------------------------------------------------- -->
  <!-- ---------------------------------------------------------------------- -->
  <!-- NOTE: These fields are optional debugging elements. Please uncomment   -->
  <!-- these lines if you wish to test in debug mode.                         -->
  <!-- <input type="hidden" name="debug" value=1>                             -->
  <!-- <input type="hidden" name="debugEmail"                                 -->
  <!-- value="eduardo.asenjo+web2case-ni@pexlify.com">                    -->
  <!-- ---------------------------------------------------------------------- -->
  <form
    action="https://niac--uat.my.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8"
    method="POST"
  >
    <div style="font-weight: bold">
      Welcome to Bank of Ireland Life's Secure Portal for customer to update
      their direct debit details. Please complete the following pages in order
      to amend your details. Please note that requests will be processed on next
      appropriate business working day in line with your billing date.
    </div>
    <input type="hidden" name="debug" value="1" />
    <input type="hidden" name="debugEmail" value="eduardo.asenjo@pexlify.com" />
    <input type="hidden" name="orgid" value="00D3O0000008m78" />
    <input
      name="retURL"
      type="hidden"
      value="https://test.raspisdojo.com/thankyou"
    />
    <input id="type" name="type" type="hidden" value="DDM_Form" />Please provide
    your Policy Number:<input
      id="00N3O00000BFMdw"
      maxlength="20"
      name="00N3O00000BFMdw"
      required="true"
      size="20"
      type="text"
    />

    Please provide your Unique Identifier:
    <input
      id="00N3O00000BFMdx"
      maxlength="20"
      name="00N3O00000BFMdx"
      required="true"
      size="20"
      type="text"
    />
    <div>
      Bank Account Holder Name:
      <input
        id="00N3O00000BFMdu"
        maxlength="255"
        name="00N3O00000BFMdu"
        required="true"
        size="20"
        type="text"
      />
      <div>
        New IBAN:
        <input
          id="00N3O00000BFMe0"
          maxlength="32"
          name="00N3O00000BFMe0"
          pattern="^(?:(?:IT|SM)\d{2}[A-Z]\d{22}|CY\d{2}[A-Z]\d{23}|NL\d{2}[A-Z]{4}\d{10}|LV\d{2}[A-Z]{4}\d{13}|(?:BG|BH|GB|IE)\d{2}[A-Z]{4}\d{14}|GI\d{2}[A-Z]{4}\d{15}|RO\d{2}[A-Z]{4}\d{16}|KW\d{2}[A-Z]{4}\d{22}|MT\d{2}[A-Z]{4}\d{23}|NO\d{13}|(?:DK|FI|GL|FO)\d{16}|MK\d{17}|(?:AT|EE|KZ|LU|XK)\d{18}|(?:BA|HR|LI|CH|CR)\d{19}|(?:GE|DE|LT|ME|RS)\d{20}|IL\d{21}|(?:AD|CZ|ES|MD|SA)\d{22}|PT\d{23}|(?:BE|IS)\d{24}|(?:FR|MR|MC)\d{25}|(?:AL|DO|LB|PL)\d{26}|(?:AZ|HU)\d{27}|(?:GR|MU)\d{28})$"
          required="true"
          size="32"
          type="text"
        />
        <div>
          New BIC:
          <input
            id="00N3O00000BFMdz"
            maxlength="11"
            name="00N3O00000BFMdz"
            pattern="([a-zA-Z]{4})([a-zA-Z]{2})(([2-9a-zA-Z]{1})([0-9a-np-zA-NP-Z]{1}))((([0-9a-wy-zA-WY-Z]{1})([0-9a-zA-Z]{2}))|([xX]{3})|)"
            required="true"
            size="15"
            type="text"
          />

          &nbsp;
          <div>
            Please confirm that the bank account belongs to the existing payee:
            <input
              id="00N3O00000BFMdv"
              name="00N3O00000BFMdv"
              required="true"
              type="checkbox"
              value="1"
            />
            Is the new account a jointly held account?:<select
              id="00N3O00000BFMdy"
              title="Is the new account a jointly held account?"
              name="00N3O00000BFMdy"
              required="true"
            >
              <option value="">--None--</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
            If this is a joint account, please tick here to confirm all parties
            agree to this account amendment:
            <input
              id="00N3O00000BFMdt"
              name="00N3O00000BFMdt"
              type="checkbox"
              value="1"
            />

            &nbsp;
          </div>
        </div>
      </div>
      <div>
        <div>
          <div>
            <div style="background-color: #f1f1f1">
              <div style="font-weight: bold">
                Please note that as you are not signing a paper mandate, by
                continuing with this form, you authorise (A) Bank of Ireland
                Life to send instructions to your bank to debit your account and
                (B) your Bank to debit your account in accordance with the
                instruction from Bank of Ireland Life.
              </div>
              &nbsp;
              <div style="font-weight: bold">
                As part of your rights, you are entitled to a refund from your
                bank under the terms and conditions of your agreement with your
                bank. A refund must be claimed within 8 weeks starting from the
                date on which your account was debited. Your rights are
                explained in a statement that you can obtain from your bank‚Äù.
                Bank of Ireland Life, 5-9 South Frederick Street, Dublin 2.
              </div>
              &nbsp;
              <div style="font-weight: bold">
                Bank of Ireland Life is a trading name of New Ireland Assurance
                Company plc. New Ireland Assurance Company plc. trading as Bank
                of Ireland Life is regulated by the Central Bank of Ireland. A
                member of Bank of Ireland Group.
              </div>
              Agree:
              <input
                id="00N3O00000BFMds"
                name="00N3O00000BFMds"
                required="true"
                type="checkbox"
                value="1"
              />
            </div>
            <input id="external" name="external" type="hidden" value="1" />
            <input
              type="hidden"
              name="captcha_settings"
              value='{"keyname":"BankAccountTest","fallback":"true","orgId":"00D3O0000008m78","ts":""}'
            />
            <div
              class="g-recaptcha"
              data-sitekey="6LdL6jUiAAAAAKOTO4sa7cmrHBDBbNH0wa89_mKU"
            ></div>

            <input name="submit" type="submit" />
          </div>
        </div>
      </div>
    </div>
  </form>

  <script>
    let SubmitButton = document.getElementsByName("submit")[0];
    let IBANInputField = document.getElementById("00N3O00000BFMe0");
    let AccountJointlyHeldInputField =
      document.getElementById("00N3O00000BFMdy");
    let AgreeCheckbox = document.getElementById("00N3O00000BFMds");
    let AccountExistingPayeeCheckbox =
      document.getElementById("00N3O00000BFMdv");
    let JointAccountCheckbox = document.getElementById("00N3O00000BFMdt");

    function onSubmitButtonClick(event) {
      let isValid = isPolicyNumberValid();
      isValid = isValid ? isValid && isAgreeValid() : false;
      isValid = isValid ? isValid && isIBANValid() : false;
      isValid = isValid ? isValid && isAccountExistingPayeeValid() : false;
      isValid = isValid ? isValid && isAccountJointlyHeldValid() : false;
      isValid = isValid ? isValid && isJointAccountValid() : false;

      // COMMENT CAPTCHA LINE BELOW TO TEST WITHOUT CAPTCHA
      isValid = isValid ? isValid && isCaptchaValid() : false;

      if (isValid === false) {
        event.preventDefault();
      }
    }

    function isPolicyNumberValid() {
      let policy_number = document.getElementById("00N3O00000BFMdw");
      return isValidPredicate(
        policy_number,
        "Your Policy Number and Unique Identifier do not match an account on record",
        () => {
          let actual_value = getDigits(policy_number.value);
          let policy_hex_value = (Number(actual_value) % 256)
            .toString(16)
            .toUpperCase();
          if (policy_hex_value.length === 1)
            policy_hex_value = "0" + policy_hex_value;
          let unique_identifier = document.getElementById("00N3O00000BFMdx");
          return policy_hex_value === unique_identifier.value.slice(0, 2);
        }
      );
    }

    function isCaptchaValid() {
      return isValidPredicate(SubmitButton, "Captcha Not Filled", () => {
        let response = document.getElementById("g-recaptcha-response");
        return response != null && response.value.trim() != "";
      });
    }

    function isIBANValid() {
      return isValidPredicate(
        IBANInputField,
        "Please confirm your New IBAN number",
        () => {
          return IBANInputField.checkValidity();
        }
      );
    }

    function isAccountExistingPayeeValid() {
      return isValid(
        AccountExistingPayeeCheckbox,
        "Please confirm the new account is held by the existing payee"
      );
    }

    function isAccountJointlyHeldValid() {
      return isValid(
        AccountJointlyHeldInputField,
        "Please confirm if account is jointly held"
      );
    }

    function isJointAccountValid() {
      return isValidPredicate(
        JointAccountCheckbox,
        "Please confirm all parties have agreed to the direct debit change",
        () => {
          let value =
            AccountJointlyHeldInputField.options[
              AccountJointlyHeldInputField.selectedIndex
            ].value;
          return value === "Yes" ? JointAccountCheckbox.checked : true;
        }
      );
    }

    function isAgreeValid() {
      return isValid(AgreeCheckbox, "The box must be checked to continue");
    }

    function onIbanInput(event) {
      IBANInputField.setCustomValidity("");
      IBANInputField.value = event.target.value.toUpperCase();
      IBANInputField.setSelectionRange(
        IBANInputField.selectionStart,
        IBANInputField.selectionStart
      );
    }

    function onAccountJointlyHeldInput() {
      AccountJointlyHeldInputField.setCustomValidity("");
      let value =
        AccountJointlyHeldInputField.options[
          AccountJointlyHeldInputField.selectedIndex
        ].value;
      if (value === "Yes") {
        JointAccountCheckbox.setAttribute("required", "");
      } else {
        JointAccountCheckbox.removeAttribute("required", "");
        JointAccountCheckbox.setCustomValidity("");
      }
    }

    function isValid(input_field, error_message) {
      let input_type = input_field.type;
      let valid;
      if (input_type === "checkbox") {
        valid = input_field.checked;
      } else {
        valid = !!input_field.value;
      }
      setValidity(input_field, error_message, valid);
      return valid;
    }

    function isValidPredicate(input_field, error_message, predicate) {
      let valid = predicate();
      setValidity(input_field, error_message, valid);
      return valid;
    }

    function setValidity(input_field, error_message, valid) {
      if (valid === false) {
        input_field.setCustomValidity(error_message);
        input_field.reportValidity();
      } else {
        input_field.setCustomValidity("");
      }
    }

    function getDigits(value) {
      let returnVal = "";
      for (i = 0; i < value.length; i++) {
        let c = value.charAt(i);
        if (c >= "0" && c <= "9") {
          returnVal = returnVal + c;
        }
      }
      return returnVal;
    }

    SubmitButton.addEventListener("click", (event) =>
      onSubmitButtonClick(event)
    );
    IBANInputField.addEventListener("input", (event) => onIbanInput(event));
    AccountJointlyHeldInputField.addEventListener("input", () =>
      onAccountJointlyHeldInput()
    );
    AgreeCheckbox.addEventListener("input", () => {
      AgreeCheckbox.setCustomValidity("");
    });
    AccountExistingPayeeCheckbox.addEventListener("input", () => {
      AccountExistingPayeeCheckbox.setCustomValidity("");
    });
    JointAccountCheckbox.addEventListener("input", () => {
      JointAccountCheckbox.setCustomValidity("");
    });

    function timestamp() {
      var response = document.getElementById("g-recaptcha-response");
      if (response == null || response.value.trim() == "") {
        var elems = JSON.parse(
          document.getElementsByName("captcha_settings")[0].value
        );
        elems["ts"] = JSON.stringify(new Date().getTime());
        document.getElementsByName("captcha_settings")[0].value =
          JSON.stringify(elems);
      }
    }
    setInterval(timestamp, 500);
  </script>
</html>
